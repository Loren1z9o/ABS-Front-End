<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard Aluno - FightZone</title>
  <link rel="stylesheet" href="dashboard.css" />
  <style>
    .artes-marcais {
      margin-top: 20px;
    }
    .artes-marcais label {
      display: block;
      margin-bottom: 5px;
    }
    button {
      margin-top: 15px;
    }
  </style>
</head>
<body>
  <header>
    <h1>Dashboard do Aluno</h1>
    <button onclick="logout()">Sair</button>
  </header>
  <main>
    <section class="info">
      <h2>Bem-vindo, <span id="nomeUsuario"></span></h2>
      <p>Aqui você pode visualizar suas informações e gerenciar sua conta.</p>
    </section>

    <section class="artes-marcais">
      <h3>Escolha a arte marcial que deseja treinar:</h3>
      <form id="formArtes">
        <label><input type="checkbox" name="arte" value="Jiu-Jitsu" /> Jiu-Jitsu</label>
        <label><input type="checkbox" name="arte" value="Muay Thai" /> Muay Thai</label>
        <label><input type="checkbox" name="arte" value="Karatê" /> Karatê</label>
        <label><input type="checkbox" name="arte" value="Boxe" /> Boxe</label>
        <button type="button" onclick="salvarArtes()">Salvar Artes Escolhidas</button>
      </form>
      <div id="mensagemLimite" style="color:red; margin-top: 5px;"></div>
    </section>

    <section>
      <button onclick="contatarProfessor()">Entrar em contato com o professor</button>
    </section>

    <section>
      <button onclick="excluirConta()" class="excluir">Excluir minha conta</button>
    </section>
  </main>

  <script>
    const horariosArtes = {
      'Jiu-Jitsu': { professor: 'Professor Carlos' },
      'Muay Thai': { professor: 'Professor Ana' },
      'Karatê': { professor: 'Professor Roberto' },
      'Boxe': { professor: 'Professor Paulo' },
    };

    const usuarioLogado = JSON.parse(localStorage.getItem('usuarioLogado'));
    document.getElementById('nomeUsuario').textContent = usuarioLogado?.nome || 'Aluno';

    const artesSalvas = JSON.parse(localStorage.getItem('artesEscolhidas')) || [];

    window.onload = () => {
      const checkboxes = document.querySelectorAll('input[name="arte"]');
      checkboxes.forEach(chk => {
        if (artesSalvas.includes(chk.value)) chk.checked = true;
      });
    };

    document.getElementById('formArtes').addEventListener('change', () => {
      const selecionados = document.querySelectorAll('input[name="arte"]:checked');
      const mensagem = document.getElementById('mensagemLimite');
      if (selecionados.length > 4) {
        mensagem.textContent = 'Você pode escolher no máximo 4 artes marciais.';
        selecionados[selecionados.length - 1].checked = false;
      } else {
        mensagem.textContent = '';
      }
    });

    function salvarArtes() {
      const selecionados = Array.from(document.querySelectorAll('input[name="arte"]:checked')).map(c => c.value);
      if (selecionados.length === 0) {
        alert('Selecione ao menos uma arte marcial.');
        return;
      }
      localStorage.setItem('artesEscolhidas', JSON.stringify(selecionados));
      alert('Artes marciais salvas!');
    }

    function contatarProfessor() {
      const selecionados = Array.from(document.querySelectorAll('input[name="arte"]:checked')).map(c => c.value);
      if (selecionados.length === 0) {
        alert('Por favor, selecione ao menos uma arte marcial para contatar o professor.');
        return;
      }

      let arteEscolhida = '';
      if (selecionados.length === 1) {
        arteEscolhida = selecionados[0];
      } else {
        arteEscolhida = prompt('Você escolheu mais de uma arte. Qual professor deseja contatar?\n' + selecionados.join(', '));
        if (!selecionados.includes(arteEscolhida)) {
          alert('Arte marcial inválida.');
          return;
        }
      }

      const professor = horariosArtes[arteEscolhida]?.professor || 'Professor(a)';
      const mensagem = prompt(`Digite a mensagem para o(a) ${professor}:`);

      if (mensagem && mensagem.trim() !== '') {
        alert(`Mensagem enviada para ${professor}:\n"${mensagem}"`);
      } else {
        alert('Mensagem vazia. Operação cancelada.');
      }
    }

    function logout() {
      localStorage.removeItem('usuarioLogado');
      window.location.href = 'index.html';
    }

    function excluirConta() {
      if (confirm("Tem certeza que deseja excluir sua conta?")) {
        let usuarios = JSON.parse(localStorage.getItem('usuarios')) || [];
        usuarios = usuarios.filter(u => u.email !== usuarioLogado.email);
        localStorage.setItem('usuarios', JSON.stringify(usuarios));
        localStorage.removeItem('usuarioLogado');
        alert("Conta excluída com sucesso.");
        window.location.href = 'index.html';
      }
    }
  </script>
</body>
</html>
